# Step 1: Import library

import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
%matplotlib inline

# Step 2: Load dataset

df=pd.read_csv('californiahouse.csv')
df.head()
# Step 3: Exploratora Data Analysis

df.info()
df.describe()
df.isnull().sum()
## Univariate analysis
sns.histplot(df['total_bedrooms'], kde=True,bins=30)
plt.title("Distribution of Total Bedrooms")
plt.show()

## Correlation with target
corr=df.select_dtypes(include=['number']).corr()
plt.figure(figsize=(10,6))
sns.heatmap(corr,annot=True,cmap='coolwarm')
plt.title(" Correlation Heatmap")
plt.show()

print(corr['median_house_value'].sort_values(ascending=False))

## Bivariate Analysis

sns.scatterplot(x='median_income',y='median_house_value',data=df,color='r')
plt.show()
sns.scatterplot(x='total_rooms',y='median_house_value',data=df)
plt.show()

sns.boxenplot(x='ocean_proximity',y='median_house_value',data=df)
plt.title("House Value By Ocean Proximity")
plt.show()

## Heatmap (correlation with target)
corr=df.select_dtypes(include=['number']).corr()
plt.figure(figsize=(10,6))
sns.heatmap(corr[['median_house_value']].sort_values(by='median_house_value',ascending=False),annot=True,cmap='coolwarm')
plt.title("Correlation with House Value")
plt.show()

sns.histplot(df['median_house_value'],kde=True,bins=30)
plt.title('Distribution Of Median House Value')
plt.show()

## Multivariate Analysis

sns.pairplot(df[['median_income','total_rooms','households','median_house_value']], diag_kind='kde')
plt.suptitle("Pairplot of Selected Features", y=1.02)
plt.show()

## Pivot Table / Group Analysis
avg_price_by_location = df.groupby('ocean_proximity')['median_house_value'].mean().sort_values()
print("Average House Value by Ocean Proximity:")
print(avg_price_by_location)

## 3D Scatter Plot

from mpl_toolkits.mplot3d import Axes3D

fig = plt.figure(figsize=(8,6))
ax = fig.add_subplot(111, projection='3d')
ax.scatter(df['median_income'], df['households'], df['median_house_value'], 
           c='blue', alpha=0.5)
ax.set_xlabel('Median Income')
ax.set_ylabel('Households')
ax.set_zlabel('House Value')
plt.title("3D Scatter: Income & Households vs House Value")
plt.show()

df.fillna({'total_bedrooms': df['total_bedrooms'].median()}, inplace=True)
df=pd.get_dummies(df,columns=['ocean_proximity'],drop_first=True)
df.head()

## Feature Scaling

X=df.drop('median_house_value',axis=1)
y=df['median_house_value']

from sklearn.preprocessing import StandardScaler
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

X_scaled = pd.DataFrame(X_scaled, columns=X.columns)

## Train-Test Split
from sklearn.model_selection import train_test_split
X_train,X_test,y_train,y_test=train_test_split(X,y,train_size=0.3,random_state=42)
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

## Apply Linear Regression To fit The Model
from sklearn.linear_model import LinearRegression
model=LinearRegression()
model.fit(X_train,y_train)

y_pred=model.predict(X_test)


## Model Evaluation
from sklearn.metrics import mean_absolute_error,mean_squared_error,r2_score
mae=mean_absolute_error(y_test,y_pred)
mse=mean_squared_error(y_test,y_pred)
r2score=r2_score(y_test,y_pred)
print("Mean Absolute Error:",mae)
print("Mean Squared Error:",mse)
print("R2 Score:",r2score)

## Actual vs Predicted
plt.figure(figsize=(6,6))
plt.scatter(y_test, y_pred, alpha=0.5)
plt.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], 'r--', lw=2)
plt.xlabel("Actual Median House Value")
plt.ylabel("Predicted Median House Value")
plt.title("Linear Regression: Actual vs Predicted")
plt.show()

## Residual plot
residuals = y_test - y_pred
plt.figure(figsize=(6,4))
plt.scatter(y_pred, residuals, alpha=0.5)
plt.axhline(y=0, color='r', linestyle='--')
plt.xlabel("Predicted Values")
plt.ylabel("Residuals (Actual - Predicted)")
plt.title("Linear Regression: Residual Plot")
plt.show()



